name: "Test Symfony Dev"

on:
    push: ~
    pull_request:

env:
    fail-fast: true

jobs:
    tests:
        runs-on: 'ubuntu-latest'
        continue-on-error: true

        strategy:
            matrix:
                symfony-version: ['5.4.x@dev', '6.0.x@dev']

        steps:
            -
                name: 'Checkout code'
                uses: actions/checkout@v2.3.3

            - 
                name: 'Install PHP with extensions'
                uses: shivammathur/setup-php@2.7.0
                with:
                    coverage: none
                    php-version: '8.0'
                    tools: flex

            -
                name: Remove dev dependencies not compatible with Symfony Dev
                if: startsWith(matrix.symfony-version, '6.0')
                run: composer remove sylius-labs/coding-standard vimeo/psalm --dev --no-update --no-interaction

            - 
                name: 'Install project dependencies'
                env:
                    SYMFONY_REQUIRE: ${{ matrix.symfony-version }}
                run: |
                    composer config minimum-stability dev
                    composer update --no-interaction --prefer-dist --optimize-autoloader

            - 
                name: 'Run tests'
                run: composer test || exit 0
